# åå°ä»£ç è‡ªæŸ¥æ–¹æ¡ˆ

## ğŸ“‹ åŸºç¡€ä¿¡æ¯
- å®é™…çš„ç«¯å£é…ç½®æ˜¯ï¼š
æœ¬åœ°å¼€å‘ï¼šhttp://localhost:5270 (å‘½ä»¤è¡ŒæŒ‡å®š)
ç”Ÿäº§éƒ¨ç½²ï¼šhttp://47.92.95.129:9999 (å®é™…éƒ¨ç½²ç«¯å£)
- **å¼€å‘ç¯å¢ƒä»£ç†**: `http://localhost:8080` â†’ `/dev-api`

## ğŸ” APIæ¥å£è‡ªæŸ¥æ¸…å•

### 1. æ ¸å¿ƒè®¤è¯æ¥å£

#### 1.1 ç™»å½•æ¥å£ `/login`
```http
POST /login
Content-Type: application/json
```

**å‰ç«¯å‘é€æ•°æ®**:
```json
{
  "username": "admin",
  "password": "encrypted_password",
  "code": "éªŒè¯ç ",
  "uuid": "éªŒè¯ç UUID"
}
```

**åå°åº”è¿”å›**:
```json
{
  "code": 200,
  "msg": "æ“ä½œæˆåŠŸ",
  "token": "eyJhbGciOiJIUzUxMiJ9..."
}
```

**âš ï¸ æ£€æŸ¥ç‚¹**:
- [ ] æ¥å£è·¯å¾„æ˜¯å¦ä¸º `/login`
- [ ] æ˜¯å¦æ”¯æŒ POST æ–¹æ³•
- [ ] è¿”å›æ•°æ®åŒ…å« `token` å­—æ®µ
- [ ] çŠ¶æ€ç ä¸º 200 è¡¨ç¤ºæˆåŠŸ

#### 1.2 è·å–ç”¨æˆ·ä¿¡æ¯æ¥å£ `/getInfo`
```http
GET /getInfo
Authorization: Bearer {token}
```

**åå°åº”è¿”å›**:
```json
{
  "code": 200,
  "msg": "æ“ä½œæˆåŠŸ",
  "user": {
    "userId": 1,
    "userName": "admin",
    "nickName": "ç®¡ç†å‘˜",
    "email": "admin@example.com",
    "avatar": "/upload/avatar.jpg"
  },
  "roles": ["admin"],
  "permissions": ["*:*:*"]
}
```

**âš ï¸ æ£€æŸ¥ç‚¹**:
- [ ] æ¥å£è·¯å¾„æ˜¯å¦ä¸º `/getInfo`
- [ ] æ˜¯å¦æ”¯æŒ GET æ–¹æ³•
- [ ] éªŒè¯ Authorization Bearer Token
- [ ] è¿”å›ç»“æ„åŒ…å« `user`, `roles`, `permissions` å­—æ®µ
- [ ] `roles` å¿…é¡»æ˜¯æ•°ç»„æ ¼å¼
- [ ] `user.avatar` å¯ä»¥ä¸ºç©ºæˆ–ç›¸å¯¹è·¯å¾„

#### 1.3 é€€å‡ºç™»å½•æ¥å£ `/logout`
```http
GET /logout
Authorization: Bearer {token}
```

**åå°åº”è¿”å›**:
```json
{
  "code": 200,
  "msg": "æ“ä½œæˆåŠŸ"
}
```

**âš ï¸ æ£€æŸ¥ç‚¹**:
- [ ] æ¥å£è·¯å¾„æ˜¯å¦ä¸º `/logout`
- [ ] æ˜¯å¦æ”¯æŒ GET æ–¹æ³• (å‰ç«¯å·²ä¿®æ”¹ä¸ºGET)
- [ ] æ¥æ”¶å¹¶éªŒè¯token
- [ ] æ¸…é™¤æœåŠ¡ç«¯session/token

#### 1.4 éªŒè¯ç æ¥å£ `/captchaImage`
```http
GET /captchaImage
```

**åå°åº”è¿”å›**:
```json
{
  "code": 200,
  "msg": "æ“ä½œæˆåŠŸ",
  "captchaEnabled": true,
  "img": "iVBORw0KGgoAAAANSUhEUgAAAG...", // base64ç¼–ç çš„å›¾ç‰‡æ•°æ®
  "uuid": "unique-uuid-string"
}
```

**âš ï¸ æ£€æŸ¥ç‚¹**:
- [ ] æ¥å£è·¯å¾„æ˜¯å¦ä¸º `/captchaImage`
- [ ] æ˜¯å¦æ”¯æŒ GET æ–¹æ³•
- [ ] è¿”å› `img` å­—æ®µåŒ…å«base64å›¾ç‰‡æ•°æ®
- [ ] è¿”å› `uuid` ç”¨äºéªŒè¯ç æ ¡éªŒ
- [ ] `captchaEnabled` å­—æ®µæ§åˆ¶æ˜¯å¦å¯ç”¨éªŒè¯ç 

### 2. æ¨èæ•°æ®æ¥å£

#### 2.1 æœåŠ¡ä¸»ä½“åˆ—è¡¨ `/public/servicer/list`
```http
GET /public/servicer/list?pageNum=1&pageSize=10
```

**åå°åº”è¿”å›**:
```json
{
  "code": 200,
  "msg": "æ“ä½œæˆåŠŸ",
  "rows": [
    {
      "id": 1,
      "name": "æœåŠ¡ä¸»ä½“åç§°",
      "typeId": "1",
      "pictureUrls": "image1.jpg,image2.jpg",
      "description": "æœåŠ¡æè¿°"
    }
  ],
  "total": 100
}
```

**âš ï¸ æ£€æŸ¥ç‚¹**:
- [ ] æ¥å£è·¯å¾„æ˜¯å¦ä¸º `/public/servicer/list`
- [ ] æ˜¯å¦æ”¯æŒ GET æ–¹æ³•
- [ ] è¿”å›ç»“æ„åŒ…å« `rows` (æ•°æ®æ•°ç»„) å’Œ `total` (æ€»æ•°)
- [ ] æ”¯æŒåˆ†é¡µå‚æ•° `pageNum`, `pageSize`

#### 2.2 æœåŠ¡æ ‡å‡†åˆ—è¡¨ `/public/standards/list`
```http
GET /public/standards/list?pageNum=1&pageSize=10
```

**åå°åº”è¿”å›**:
```json
{
  "code": 200,
  "msg": "æ“ä½œæˆåŠŸ",
  "rows": [
    {
      "id": 1,
      "fileName": "æ ‡å‡†æ–‡ä»¶å",
      "coverImage": "cover.jpg",
      "issuingAgency": "å‘å¸ƒæœºæ„",
      "attachments": "file1.pdf,file2.pdf"
    }
  ],
  "total": 50
}
```

**âš ï¸ æ£€æŸ¥ç‚¹**:
- [ ] æ¥å£è·¯å¾„æ˜¯å¦ä¸º `/public/standards/list`
- [ ] æ˜¯å¦æ”¯æŒ GET æ–¹æ³•
- [ ] è¿”å›ç»“æ„åŒ…å« `rows` å’Œ `total` å­—æ®µ
- [ ] æ”¯æŒåˆ†é¡µå‚æ•°

### 3. æ‰‹æœºéªŒè¯ç æ¥å£

#### 3.1 å‘é€éªŒè¯ç  `/sendPhoneCode`
```http
POST /sendPhoneCode
Content-Type: application/json
```

**å‰ç«¯å‘é€æ•°æ®**:
```json
{
  "phone": "13888888888"
}
```

#### 3.2 æ‰‹æœºç™»å½• `/phoneLogin`
```http
POST /phoneLogin
Content-Type: application/json
```

**å‰ç«¯å‘é€æ•°æ®**:
```json
{
  "phone": "13888888888",
  "phoneCode": "123456"
}
```

## ğŸ”§ é€šç”¨å“åº”æ ¼å¼è§„èŒƒ

### æˆåŠŸå“åº”
```json
{
  "code": 200,
  "msg": "æ“ä½œæˆåŠŸ",
  "data": {} // å…·ä½“æ•°æ®
}
```

### é”™è¯¯å“åº”
```json
{
  "code": 500,
  "msg": "å…·ä½“é”™è¯¯ä¿¡æ¯"
}
```

### å‰ç«¯å¤„ç†çš„é”™è¯¯ç 
- `401`: æœªæˆæƒ/tokenè¿‡æœŸ â†’ è‡ªåŠ¨è·³è½¬ç™»å½•
- `500`: æœåŠ¡å™¨é”™è¯¯ â†’ æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
- `601`: ä¸šåŠ¡è­¦å‘Š â†’ æ˜¾ç¤ºè­¦å‘Šæ¶ˆæ¯
- `å…¶ä»–é200`: æ˜¾ç¤ºé€šçŸ¥é”™è¯¯

## ğŸŒ CORSè·¨åŸŸé…ç½®

### Spring Booté…ç½®ç¤ºä¾‹
```java
@Configuration
public class CorsConfig {
    @Bean
    public CorsFilter corsFilter() {
        CorsConfiguration config = new CorsConfiguration();
        config.addAllowedOrigin("http://47.92.95.129:9999");
        config.addAllowedOriginPattern("*");
        config.addAllowedMethod("*");
        config.addAllowedHeader("*");
        config.setAllowCredentials(true);
        
        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration("/**", config);
        return new CorsFilter(source);
    }
}
```

## ğŸ” è®¤è¯æˆæƒé…ç½®

### JWT Tokené…ç½®
- **è¯·æ±‚å¤´**: `Authorization: Bearer {token}`
- **Tokenå‰ç¼€**: `Bearer `
- **Tokenè¶…æ—¶**: å»ºè®®30åˆ†é’Ÿ-2å°æ—¶

### è§’è‰²æƒé™
å‰ç«¯æœŸæœ›çš„è§’è‰²åç§°ï¼š
- `admin` æˆ– `ROLE_ADMIN`: è¶…çº§ç®¡ç†å‘˜
- `servicer` æˆ– `ROLE_SERVICER`: æœåŠ¡ä¸»ä½“
- `producter` æˆ– `ROLE_PRODUCTER`: ç”Ÿäº§ä¸»ä½“

## ğŸ“ é™æ€èµ„æºé…ç½®

### æ–‡ä»¶ä¸Šä¼ è·¯å¾„
- **å¤´åƒä¸Šä¼ **: `/upload/avatar/`
- **æ ‡å‡†æ–‡ä»¶**: `/upload/standards/`
- **å›¾ç‰‡èµ„æº**: `/upload/images/`

### é™æ€èµ„æºè®¿é—®
```java
@Configuration
public class WebMvcConfig implements WebMvcConfigurer {
    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("/upload/**")
                .addResourceLocations("file:./upload/");
    }
}
```

## ğŸ—ƒï¸ æ•°æ®åº“å­—æ®µæ£€æŸ¥

### ç”¨æˆ·è¡¨å­—æ®µ
```sql
CREATE TABLE sys_user (
    user_id BIGINT PRIMARY KEY,
    user_name VARCHAR(30) NOT NULL,
    nick_name VARCHAR(30),
    email VARCHAR(50),
    avatar VARCHAR(100),
    status CHAR(1) DEFAULT '0'
);
```

### è§’è‰²è¡¨å…³è”
```sql
-- ç¡®ä¿ç”¨æˆ·è§’è‰²å…³è”è¡¨æ­£ç¡®
SELECT u.user_name, r.role_key 
FROM sys_user u 
LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id
LEFT JOIN sys_role r ON ur.role_id = r.role_id
WHERE u.user_name = 'admin';
```

## ğŸš€ éƒ¨ç½²æ£€æŸ¥æ¸…å•

### 1. åº”ç”¨é…ç½®
- [ ] ç«¯å£é…ç½®: `server.port=9999`
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] Redisè¿æ¥æ­£å¸¸(å¦‚ä½¿ç”¨)
- [ ] æ–‡ä»¶ä¸Šä¼ ç›®å½•å­˜åœ¨ä¸”æœ‰å†™æƒé™

### 2. å®‰å…¨é…ç½®
- [ ] HTTPSé…ç½®(ç”Ÿäº§ç¯å¢ƒæ¨è)
- [ ] è·¨åŸŸé…ç½®æ­£ç¡®
- [ ] å®‰å…¨å¤´é…ç½®

### 3. æ—¥å¿—é…ç½®
å»ºè®®æ·»åŠ æ¥å£è®¿é—®æ—¥å¿—ï¼š
```java
@Slf4j
@RestController
public class AuthController {
    
    @PostMapping("/login")
    public Result login(@RequestBody LoginRequest request) {
        log.info("ç™»å½•è¯·æ±‚: username={}", request.getUsername());
        // ç™»å½•é€»è¾‘
    }
    
    @GetMapping("/getInfo")
    public Result getInfo(HttpServletRequest request) {
        String token = request.getHeader("Authorization");
        log.info("è·å–ç”¨æˆ·ä¿¡æ¯è¯·æ±‚: token={}", token);
        // è·å–ç”¨æˆ·ä¿¡æ¯é€»è¾‘
    }
}
```

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### 1. éªŒè¯ç ä¸æ˜¾ç¤º
- æ£€æŸ¥ `/captchaImage` æ¥å£è¿”å›çš„ `img` å­—æ®µ
- ç¡®è®¤è¿”å›çš„æ˜¯base64ç¼–ç çš„å›¾ç‰‡æ•°æ®
- æ£€æŸ¥éªŒè¯ç ç”Ÿæˆåº“æ˜¯å¦æ­£å¸¸å·¥ä½œ

### 2. ç”¨æˆ·ä¿¡æ¯è·å–å¤±è´¥
- æ£€æŸ¥tokenéªŒè¯é€»è¾‘
- ç¡®è®¤è¿”å›çš„æ•°æ®ç»“æ„åŒ…å« `user`, `roles`, `permissions`
- æ£€æŸ¥è§’è‰²æŸ¥è¯¢SQLæ˜¯å¦æ­£ç¡®

### 3. æ¨èåˆ—è¡¨ä¸æ˜¾ç¤º
- ç¡®è®¤è¿”å›æ•°æ®æ ¼å¼ä¸º `{rows: [], total: 0}`
- æ£€æŸ¥åˆ†é¡µå‚æ•°å¤„ç†
- ç¡®è®¤æ•°æ®åº“ä¸­æœ‰æµ‹è¯•æ•°æ®

### 4. åå°ç®¡ç†è®¿é—®å¤±è´¥
- æ£€æŸ¥ç”¨æˆ·è§’è‰²æ˜¯å¦åŒ…å« `admin`
- ç¡®è®¤åŠ¨æ€è·¯ç”±æ¥å£ `/getRouters` è¿”å›æ­£ç¡®
- æ£€æŸ¥æƒé™è¿‡æ»¤å™¨é…ç½®

## ğŸ§ª æ¥å£æµ‹è¯•å·¥å…·

ä½¿ç”¨ä»¥ä¸‹å·¥å…·æµ‹è¯•æ¥å£ï¼š

### Postmanæµ‹è¯•
```bash
# 1. è·å–éªŒè¯ç 
GET http://47.92.95.129:9999/captchaImage

# 2. ç™»å½•
POST http://47.92.95.129:9999/login
{
  "username": "admin",
  "password": "admin123",
  "code": "1234",
  "uuid": "uuid-from-captcha"
}

# 3. è·å–ç”¨æˆ·ä¿¡æ¯
GET http://47.92.95.129:9999/getInfo
Authorization: Bearer your-token-here
```

### curlæµ‹è¯•
```bash
# æµ‹è¯•éªŒè¯ç æ¥å£
curl -X GET "http://47.92.95.129:9999/captchaImage"

# æµ‹è¯•ç™»å½•æ¥å£
curl -X POST "http://47.92.95.129:9999/login" \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
```

---

**âš¡ å¿«é€Ÿæ£€æŸ¥å‘½ä»¤**
1. æ£€æŸ¥åº”ç”¨æ˜¯å¦å¯åŠ¨: `curl http://47.92.95.129:9999/captchaImage`
2. æ£€æŸ¥è·¨åŸŸé…ç½®: æµè§ˆå™¨F12æŸ¥çœ‹Response Headers
3. æ£€æŸ¥æ—¥å¿—: `tail -f logs/application.log`
4. æ£€æŸ¥æ•°æ®åº“è¿æ¥: æŸ¥çœ‹å¯åŠ¨æ—¥å¿—ä¸­çš„æ•°æ®åº“è¿æ¥ä¿¡æ¯

æŒ‰æ­¤æ¸…å•é€é¡¹æ£€æŸ¥ï¼Œåº”è¯¥èƒ½å¿«é€Ÿå®šä½å’Œè§£å†³åå°ä»£ç é—®é¢˜ï¼
